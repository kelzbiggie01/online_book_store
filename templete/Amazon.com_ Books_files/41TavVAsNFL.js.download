'use strict';mix_d("CoreRecsFrontEndCards__p13n-desktop-ysh:p13n-desktop-ysh__iazZoN5U","exports tslib @c/aui-utils @c/logger @c/remote-operations @c/scoped-dom @p/A @c/aui-untrusted-ajax".split(" "),function(F,d,M,N,O,P,Q,R){function u(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var l=u(M),r=u(N),v=u(O),g=u(P),w=u(Q),S=u(R),G=/(?=[ \-\/])|(?=[\u3105-\u312F])|(?=[\u31A0-\u31BA])|(?=[\u4E00-\u9FD5])|(?=[\u3400-\u4DB5])|(?=[\uF900-\uFAFF])|(?=[\u3040-\u309F])|(?=[\u30A0-\u30FF])|(?=[\u3190-\u319F])/,
H=/[^\/\-\[\]():\s]/,T=function(a){var f=w["default"].$("<div>")[0];f.classList.add("p13n-sc-offscreen-truncate");var b=parseInt(a.getAttribute("data-rows")||"2",10),c=function(){var b=a.innerHTML;a.innerHTML="&hellip;";var c=a.clientHeight;a.innerHTML=b;return c}();if(b){if(c){var e=function(a){f.innerHTML=a;return Math.round(f.clientHeight/c)<=b},d=function(b,c){b=b.split(c);var e=Math.floor(a.clientWidth/12),d=function(b){f.classList.add("p13n-sc-offscreen-truncate");f.style.overflow="hidden";
f.textContent=b;a.appendChild(f);b=a.clientWidth>=a.scrollWidth;a.removeChild(f);return b},k=function(a){var b=a.length-e;a.trim().length>e&&!d(a)&&Array.prototype.slice.call(a).map(function(a,c){return c>e&&c<=b&&H.test(a)?"&shy;"+a:a});return a};return b.map(function(a){return k(a)}).join("")};return{truncate:function(){var b=a.innerHTML.trim(),c=a.textContent||"";b=d(b,G);a.appendChild(f);if(e(b))a.removeChild(f),a.innerHTML=b;else{var g=b.split(G);for(var n=1,m=g.length,p,x,q=0;n!==m;)if(p=Math.floor((m+
n)/2),x=g.slice(0,p).join("")+"&hellip;",e(x)){if(1>=m-p){for(q=p;0<q&&!H.test(g[q-1]);)q--;break}n=p}else m=p;g=0===q?void 0:g.slice(0,q).join("")+"&hellip;";g?(a.innerHTML=g,a.setAttribute("title",c)):(r["default"].log("Unable to successfully truncate line "+b,"ERROR"),a.removeChild(f))}}}}r["default"].log("Truncation element does not have a line height or it is zero","ERROR")}else r["default"].log("Truncation element missing necessary line number data","ERROR")},J=function(a){var f=Array.prototype.slice.call(a.getElementsByClassName("p13n-sc-truncate"));
a=a.getElementsByClassName("p13n-sc-truncate-fallback");(window.CSS&&CSS.supports&&CSS.supports("-webkit-line-clamp","1")?f:f.concat(Array.prototype.slice.call(a))).filter(function(a){return!!a.offsetParent}).map(function(a){var b=T(a);b&&(b.truncate(),a.classList.add("p13n-sc-truncated"),a.classList.remove("p13n-sc-truncate"),a.classList.remove("p13n-sc-truncate-fallback"),a.className=a.className.replace(/p13n-sc-line-clamp-\d/g,""))})},V=function(a){Array.prototype.slice.call(a.getElementsByClassName("p13n-individual-feedbackToggle")).forEach(function(a){var b=
a.getElementsByTagName("input")[0];w["default"].on("a:switch:"+a.dataset.asin+":flip",function(){return d.__awaiter(void 0,void 0,void 0,function(){return d.__generator(this,function(c){switch(c.label){case 0:return[4,U(a,b.checked,void 0,function(){r["default"].log("Failed to record feedback on flip of the toggle switch")})];case 1:return c.sent(),[2]}})})})})},K=function(a,f,b){void 0===f&&(f=function(){});void 0===b&&(b=function(){});return d.__awaiter(void 0,void 0,void 0,function(){return d.__generator(this,
function(c){switch(c.label){case 0:return a.dataset.event?[4,A(a.dataset.event,a,f,b)]:[3,2];case 1:return c.sent(),[3,5];case 2:return a.dataset.url?[4,B(a.dataset.url,f,b)]:[3,4];case 3:return c.sent(),[3,5];case 4:r["default"].log("Element is missing dataset.url or dataset.event attribute"),b(),c.label=5;case 5:return[2]}})})},U=function(a,f,b,c){void 0===b&&(b=function(){});void 0===c&&(c=function(){});return d.__awaiter(void 0,void 0,void 0,function(){return d.__generator(this,function(e){switch(e.label){case 0:return f?
a.dataset.onevent?[4,A(a.dataset.onevent,a,b,c)]:[3,2]:[3,6];case 1:return e.sent(),[3,5];case 2:return a.dataset.onurl?[4,B(a.dataset.onurl,b,c)]:[3,4];case 3:return e.sent(),[3,5];case 4:r["default"].log("Element is missing dataset.onurl or dataset.onevent attribute"),c(),e.label=5;case 5:return[3,11];case 6:return a.dataset.offevent?[4,A(a.dataset.offevent,a,b,c)]:[3,8];case 7:return e.sent(),[3,11];case 8:return a.dataset.offurl?[4,B(a.dataset.offurl,b,c)]:[3,10];case 9:return e.sent(),[3,11];
case 10:r["default"].log("Element is missing dataset.offurl dataset.offevent attribute"),c(),e.label=11;case 11:return[2]}})})},A=function(a,f,b,c){return d.__awaiter(void 0,void 0,void 0,function(){var e,g,k,h,l,n,m,p,x,q,y;return d.__generator(this,function(t){switch(t.label){case 0:e=function(a){return d.__awaiter(void 0,void 0,void 0,function(){var f,e;return d.__generator(this,function(d){switch(d.label){case 0:return f=function(a){a?b():(r["default"].log("Failed to call PPDS custom API"),c())},
e=function(a){r["default"].log("Caught error when calling PPDS custom API: "+a.stack);c()},[4,a().then(f).catch(e)];case 1:return d.sent(),[2]}})})};g=function(a){return d.__awaiter(void 0,void 0,void 0,function(){var b;return d.__generator(this,function(d){switch(d.label){case 0:if(!f.dataset.asin)return[3,2];b={asin:f.dataset.asin};return[4,e(a.bind(null,b))];case 1:return d.sent(),[3,3];case 2:r["default"].log("Element was missing required data: asin"),c(),d.label=3;case 3:return[2]}})})};k=a;
switch(k){case "EXCLUDE":return[3,1];case "DELETE_EXCLUDE":return[3,3];case "DELETE_ITEM_FROM_VIEW":return[3,5];case "NOT_INTERESTED":return[3,7];case "DELETE_NOT_INTERESTED":return[3,11];case "ENABLE_CLICK_STREAM_TRACKING":return[3,13];case "DISABLE_CLICK_STREAM_TRACKING":return[3,15]}return[3,17];case 1:return h=v["default"].setup(["recordExclude"]),[4,g(h.recordExclude)];case 2:return t.sent(),[3,18];case 3:return l=v["default"].setup(["deleteExclude"]),[4,g(l.deleteExclude)];case 4:return t.sent(),
[3,18];case 5:return n=v["default"].setup(["deleteItemFromView"]),[4,g(n.deleteItemFromView)];case 6:return t.sent(),[3,18];case 7:if(!f.dataset.asin)return[3,9];m={asin:f.dataset.asin,strategyId:f.dataset.strategyId,widgetGroupId:f.dataset.widgetGroupId};p=v["default"].setup(["recordNotInterested"]);return[4,e(p.recordNotInterested.bind(null,m))];case 8:return t.sent(),[3,10];case 9:r["default"].log("Element was missing required data: asin"),c(),t.label=10;case 10:return[3,18];case 11:return x=v["default"].setup(["deleteNotInterested"]),
[4,g(x.deleteNotInterested)];case 12:return t.sent(),[3,18];case 13:return q=v["default"].setup(["enableClickStreamTracking"]),[4,e(q.enableClickStreamTracking.bind(null,{}))];case 14:return t.sent(),[3,18];case 15:return y=v["default"].setup(["disableClickStreamTracking"]),[4,e(y.disableClickStreamTracking.bind(null,{}))];case 16:return t.sent(),[3,18];case 17:return r["default"].log("Invalid PPDS event type: "+a),c(),[3,18];case 18:return[2]}})})},B=function(a,f,b){return d.__awaiter(void 0,void 0,
void 0,function(){return d.__generator(this,function(c){switch(c.label){case 0:return[4,S["default"].post(a,{accepts:"text/html,*/*",contentType:"application/x-www-form-urlencoded"}).then(function(){f()}).catch(function(c){r["default"].log("Failed to call AJAX endpoint "+a+" with error: "+c.message,"ERROR");b()})];case 1:return c.sent(),[2]}})})},W=function(a,f,b,c){a.addEventListener("click",function(){return d.__awaiter(void 0,void 0,void 0,function(){var e,I,k,h,w,n,m,p,x,q,y,t,C,u;return d.__generator(this,
function(z){switch(z.label){case 0:e=a.parentElement;if(!e||"gridItemRoot"!==e.id)return[2];I=a.id.split("-");k=parseInt(I[3],10);h=b.asinList;if(k>=h.length)return[2];w=h[k];n=function(){l["default"].hide(a);Array.prototype.slice.call(e.getElementsByClassName("p13n-grid-image-only")).forEach(function(a){m(a);l["default"].show(a)})};m=function(a){Array.prototype.slice.call(a.getElementsByClassName("p13n-product-image")).forEach(function(a){a.style.height="172px";a.style.width="auto";a.style.maxHeight=
"none";a.style.maxWidth="none"})};p=function(a){Array.prototype.slice.call(a.getElementsByClassName("closeIcon")).forEach(function(a){return a.addEventListener("click",function(){E(f)})})};x=function(){Array.prototype.slice.call(f.getElementsByClassName("expandedGridView")).forEach(function(a){return a.remove()});Array.prototype.slice.call(e.getElementsByClassName("p13n-grid-image-only")).forEach(l["default"].hide);Array.prototype.slice.call(e.getElementsByClassName("p13n-grid-content")).forEach(l["default"].hide);
var a="",b="";g["default"].cardRoot.getElementsByClassName("p13n-grid-feedbackTitle-translation")&&g["default"].cardRoot.getElementsByClassName("p13n-grid-feedbackTitle-translation")[0]&&(a=g["default"].cardRoot.getElementsByClassName("p13n-grid-feedbackTitle-translation")[0].innerHTML);g["default"].cardRoot.getElementsByClassName("p13n-grid-feedbackMessage-translation")&&g["default"].cardRoot.getElementsByClassName("p13n-grid-feedbackMessage-translation")[0]&&(b=g["default"].cardRoot.getElementsByClassName("p13n-grid-feedbackMessage-translation")[0].innerHTML);
Array.prototype.slice.call(e.getElementsByClassName("p13n-grid-overlay")).forEach(function(c){0!==a.length&&c.getElementsByClassName("p13n-grid-RemovedMessage")[0]&&(c.getElementsByClassName("p13n-grid-RemovedMessage")[0].innerHTML=a);0!==b.length&&c.getElementsByClassName("p13n-grid-RemovedDescription")[0]&&(c.getElementsByClassName("p13n-grid-RemovedDescription")[0].innerHTML=b);m(c);l["default"].show(c)});e.classList.remove("expandedGridComp")};q=function(a){var b=Array.prototype.slice.call(a.getElementsByClassName("p13n-grid-feedbackLink"));
b&&1===b.length&&b[0].addEventListener("click",function(){return d.__awaiter(void 0,void 0,void 0,function(){return d.__generator(this,function(a){switch(a.label){case 0:return[4,K(b[0],x,function(){r["default"].log("Failed to record rating on click","ERROR")})];case 1:return a.sent(),[2]}})})})};y=function(b,c){if("desktop"===b.platform){c=f.getElementsByClassName("p13n-gridRow")[0].offsetWidth;b=a.parentElement&&a.parentElement.offsetWidth+-1;if(!b)return{rowEndElementId:void 0};c=Math.floor(c/
b);b=String(c*b)+"px";return k<h.length-h.length%c?(c-=k%c,c="p13n-asin-index-"+(k+c-1),{expansionWidth:b,rowEndElementId:c}):{expansionWidth:b,rowEndElementId:"p13n-asin-index-"+(h.length-1)}}return k!==h.length-1?(c=k%b.gridMaxColumns,c="p13n-asin-index-"+(k+(b.gridMaxColumns-c-1)),{rowEndElementId:c}):{rowEndElementId:"p13n-asin-index-"+k}};t=function(){return d.__awaiter(void 0,void 0,void 0,function(){var a,h;return d.__generator(this,function(d){a={faceoutkataname:b.faceoutkataname,id:JSON.stringify(w),
linkparameters:b.linkparameters,reftagprefix:b.reftag};h=v["default"].setup(["getExpandedView"]);return[2,h.getExpandedView(a).then(function(a){if(a.hasChildNodes()&&1===a.children.length){a.children[0].id="expansion-"+k;var b=document.createElement("div");b.innerHTML=a.innerHTML;if(a=b.getElementsByClassName("p13n-grid-feedbackLink")){var d=g["default"].cardRoot.getElementsByClassName("p13n-grid-removeRecsText-translation")[0]?g["default"].cardRoot.getElementsByClassName("p13n-grid-removeRecsText-translation")[0].innerHTML:
"";0!==d.length&&a[0]&&(a[0].innerHTML=d)}p(b);q(b);a=y(c,b);d=a.rowEndElementId;a.expansionWidth&&(b.children[0].style.width=a.expansionWidth);a=g["default"].cardRoot.querySelector("#"+d);null===a||void 0===a||null===a.parentElement||void 0===a.parentElement||e.classList.contains("expandedGridComp")||(e.classList.add("expandedGridComp"),n(),a.parentElement.insertAdjacentElement("afterend",b.children[0]),J(f))}}).catch(function(a){throw Error("Failed to expand grid: "+a.message);})]})})};C=e.classList.contains("expandedGridComp");
E(f);u=Array.prototype.slice.call(f.getElementsByClassName("expandedGridView"));return C||0!==u.length?[3,2]:[4,t()];case 1:z.sent(),z.label=2;case 2:return[2]}})})});a.classList.remove("expandableGrid")},L=function(a,f,b,c){return d.__awaiter(void 0,void 0,void 0,function(){var e,g,k,h,l,n,m;return d.__generator(this,function(d){c.individualBatchAttemptsCount+=1;e=c.currentIndex;g=b.asinList;if(e>=g.length)return c.isAllContentLoaded=!0,[2,Promise.resolve(void 0)];k=g.slice(e,e+a).map(function(a){return JSON.stringify(a)});
h=k.map(function(a,b){return b+e});l={faceoutkataname:b.faceoutkataname,ids:k,indexes:h,linkparameters:b.linkparameters,offset:a.toString(),reftagprefix:b.reftag};n=function(a){a.hasChildNodes()&&Array.prototype.slice.call(a.childNodes).map(function(a){Array.prototype.slice.call(a.getElementsByClassName("p13n-grid-content")).forEach(function(a){var b=a.id.split("-"),c=parseInt(b[3],10);b[b.length-1]=(e+c).toString();a.id=b.join("-")});f.appendChild(a)})};m=v["default"].setup(["nextPage"]);return[2,
m.nextPage(l).then(function(b){n(b);c.batchFailureCount=0;c.currentIndex=e+a;c.individualBatchAttemptsCount=0;c.isProcessing=!1}).catch(function(){if(2<=c.individualBatchAttemptsCount&&(c.batchFailureCount+=1,2<=c.batchFailureCount)){c.isProcessing=!0;return}void L(a,f,b,c)})]})})},X=function(a){Array.prototype.slice.call(a.getElementsByClassName("expandedGridComp")).forEach(function(a){Array.prototype.slice.call(a.getElementsByClassName("p13n-grid-image-only")).forEach(l["default"].hide);Array.prototype.slice.call(a.getElementsByClassName("p13n-grid-content")).forEach(l["default"].show);
a.classList.remove("expandedGridComp")})},E=function(a){Array.prototype.slice.call(a.getElementsByClassName("expandedGridView")).forEach(function(a){var b=a.parentElement;null===b||void 0===b?void 0:b.removeChild(a)});X(a)},Y={initGrid:function(a){return d.__awaiter(void 0,void 0,void 0,function(){var f,b,c,e,u,k,h,v,n,m,p,x,q,y,t,C,A,z,B;return d.__generator(this,function(D){switch(D.label){case 0:b=f="desktop"===a.platform?g["default"].cardRoot.getElementsByClassName("p13n-desktop-grid")[0]:g["default"].cardRoot.getElementsByClassName("p13n-mobile-grid")[0];
if(!b)throw Error("htmlContainer not present!");if(!b.dataset)throw Error("htmlContainer dataset not present!");if(!b.children.length)throw Error("Grid table does not contain any grids!");c=b.children[0];e=b.getElementsByClassName("p13n-gridRow")[0];"mobile"===a.platform&&(u=100/a.gridMaxColumns,e.style.gridTemplateColumns="repeat(auto-fit, "+u+"%)");V(b);if(!b.dataset.clientRecsList)return[3,4];k=Number(b.dataset.indexOffset)||0;h={batchFailureCount:0,currentIndex:k,individualBatchAttemptsCount:0,
isAllContentLoaded:!1,isProcessing:!1};v=function(){if(!b.dataset)throw Error("htmlContainer dataset not present!");if(b.dataset.clientRecsList)return{asinList:JSON.parse(b.dataset.clientRecsList),faceoutkataname:b.dataset.faceoutkataname||"",linkparameters:b.dataset.linkparameters||"",reftag:b.dataset.reftag||""}};n=v();if(void 0===n)throw Error("Grid container does not contain required data set for ajax");m=b.querySelector("#endOfList");p=function(){a.enableExpansion&&Array.prototype.slice.call(c.getElementsByClassName("expandableGrid")).forEach(function(c){return W(c,
b,n,a)})};x=function(a,b){Array.prototype.slice.call(a.getElementsByClassName("expandedGridView")).forEach(function(a){return a.remove()});Array.prototype.slice.call(b.getElementsByClassName("p13n-grid-image-only")).forEach(l["default"].hide);Array.prototype.slice.call(b.getElementsByClassName("p13n-grid-content")).forEach(l["default"].hide);var c="",d="";g["default"].cardRoot.getElementsByClassName("p13n-sc-feedbackTitle-translation")&&g["default"].cardRoot.getElementsByClassName("p13n-sc-feedbackTitle-translation")[0]&&
(c=g["default"].cardRoot.getElementsByClassName("p13n-sc-feedbackTitle-translation")[0].innerHTML);g["default"].cardRoot.getElementsByClassName("p13n-sc-feedbackMessage-translation")&&g["default"].cardRoot.getElementsByClassName("p13n-sc-feedbackMessage-translation")[0]&&(d=g["default"].cardRoot.getElementsByClassName("p13n-sc-feedbackMessage-translation")[0].innerHTML);Array.prototype.slice.call(b.getElementsByClassName("p13n-grid-overlay")).forEach(function(a){0!==c.length&&a.getElementsByClassName("p13n-grid-RemovedMessage")[0]&&
(a.getElementsByClassName("p13n-grid-RemovedMessage")[0].innerHTML=c);a.getElementsByClassName("p13n-grid-RemovedDescription")[0]&&(a.getElementsByClassName("p13n-grid-RemovedDescription")[0].innerHTML=d);l["default"].show(a)});b.classList.remove("expandedGridComp")};q=function(a){Array.prototype.slice.call(a.getElementsByClassName("p13n-grid-column-root")).forEach(function(b){var c=b.getElementsByClassName("p13n-individual-feedbackButton");c&&1===c.length&&c[0].addEventListener("click",function(){return d.__awaiter(void 0,
void 0,void 0,function(){return d.__generator(this,function(d){switch(d.label){case 0:return[4,K(c[0],function(){return x(a,b)},function(){r["default"].log("Failed to remove item on click","ERROR")})];case 1:return d.sent(),[2]}})})})})};y=function(a){return d.__awaiter(void 0,void 0,void 0,function(){return d.__generator(this,function(d){switch(d.label){case 0:if(!b||!c)throw Error("htmlContainer or insertion container not present!");if(h.isProcessing)return[3,3];h.isProcessing=!0;return!l["default"].onScreen(m,
500)||h.isAllContentLoaded?[3,2]:[4,L(a,c,n,h)];case 1:return d.sent(),J(c),q(b),p(),[3,3];case 2:h.isProcessing=!1,d.label=3;case 3:return[2]}})})};t=function(){var a=g["default"].cardRoot.getElementsByClassName("expandedGridView");0!==a.length&&g["default"].cardRoot.offsetWidth!==z&&(z=g["default"].cardRoot.offsetWidth,a=a[0].id.split("-"),a=parseInt(a[a.length-1],10),E(b),g["default"].cardRoot.querySelector("#p13n-asin-index-"+a).click())};C=function(){a.enableExpansion&&Array.prototype.slice.call(c.getElementsByClassName("p13n-grid-image-only")).forEach(function(a){a.addEventListener("click",
function(){return d.__awaiter(void 0,void 0,void 0,function(){return d.__generator(this,function(a){E(b);return[2]})})})})};D.label=1;case 1:return h.isProcessing||h.isAllContentLoaded||!l["default"].onScreen(m,500)?[3,3]:[4,y(8)];case 2:return D.sent(),[3,1];case 3:A=w["default"].throttle(function(){return d.__awaiter(void 0,void 0,void 0,function(){return d.__generator(this,function(a){return[2,y(8)]})})},200);w["default"].on(w["default"].constants.BROWSER_EVENTS.SCROLL,A);z=g["default"].cardRoot.offsetWidth;
B=w["default"].throttle(t,300);if("desktop"===a.platform)w["default"].on(w["default"].constants.BROWSER_EVENTS.RESIZE,B);p();C();q(b);D.label=4;case 4:return[2]}})})}};F._operationNames=["nextPage","getExpandedView","recordNotInterested"];F.card=function(){return d.__awaiter(void 0,void 0,void 0,function(){return d.__generator(this,function(a){switch(a.label){case 0:return[4,Y.initGrid({enableExpansion:!0,gridMaxColumns:2,platform:"desktop"})];case 1:return a.sent(),[2]}})})}});
